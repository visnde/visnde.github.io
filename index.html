<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»å…¸æ‰«é›·æ¸¸æˆ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            color: #2c3e50;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 10px;
        }
        
        h1 {
            color: #3498db;
            font-size: 1.8rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .hint-btn {
            padding: 8px 15px;
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 0.9rem;
        }
        
        .hint-btn:active {
            transform: translateY(1px);
        }
        
        .top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 10px;
            gap: 8px;
        }
        
        .control-btn {
            padding: 10px 5px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1;
            text-align: center;
            font-size: 0.85rem;
            min-width: 0;
        }
        
        .control-btn:active {
            transform: translateY(1px);
        }
        
        .difficulty-btn {
            background: #3498db;
            color: white;
            position: relative;
        }
        
        .difficulty-selector {
            position: relative;
            flex: 1;
        }
        
        .difficulty-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            display: none;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .difficulty-dropdown.show {
            display: block;
        }
        
        .difficulty-option {
            padding: 10px;
            cursor: pointer;
            transition: background 0.2s;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .difficulty-option:last-child {
            border-bottom: none;
        }
        
        .difficulty-option:hover {
            background: #f0f0f0;
        }
        
        .difficulty-option.active {
            background: #3498db;
            color: white;
        }
        
        .reset-btn {
            background: #e74c3c;
            color: white;
        }
        
        .history-btn {
            background: #2ecc71;
            color: white;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background: #2c3e50;
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .info-label {
            font-size: 0.7rem;
            opacity: 0.8;
            margin-bottom: 3px;
        }
        
        .info-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .game-board-container {
            width: 100%;
            overflow: auto;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
        }
        
        .game-board {
            display: grid;
            gap: 3px;
            background: #1b5e20;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .cell {
            width: 40px;
            height: 40px;
            background: #a5d6a7;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border-radius: 3px;
            user-select: none;
            transition: all 0.1s;
            font-size: 16px;
        }
        
        .cell:active {
            transform: scale(0.95);
        }
        
        .cell.revealed {
            background: #d7ccc8;
        }
        
        .cell.flagged::before {
            content: "âš‘";
            color: #e74c3c;
            font-size: 1.3rem;
        }
        
        .cell.mine {
            background: #e74c3c;
            color: white;
        }
        
        .cell.mine::before {
            content: "ğŸ’£";
        }
        
        .number-1 { color: #3498db; }
        .number-2 { color: #2ecc71; }
        .number-3 { color: #e74c3c; }
        .number-4 { color: #9b59b6; }
        .number-5 { color: #e67e22; }
        .number-6 { color: #1abc9c; }
        .number-7 { color: #34495e; }
        .number-8 { color: #7f8c8d; }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 10px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            color: #2c3e50;
            font-weight: bold;
        }
        
        .close-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .history-panel {
            width: 100%;
        }
        
        .best-records, .all-records {
            margin-bottom: 20px;
        }
        
        .record-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .record-difficulty {
            font-weight: bold;
        }
        
        .record-time {
            color: #7f8c8d;
        }
        
        .clear-history-btn {
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
        }
        
        .message {
            margin-top: 10px;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            display: none;
            font-size: 0.9rem;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        
        .message.failure {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        @media (max-width: 500px) {
            .game-board {
                padding: 8px;
            }
            
            .cell {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .control-btn {
                padding: 8px 5px;
                font-size: 0.8rem;
            }
            
            .hint-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 400px) {
            .cell {
                width: 32px;
                height: 32px;
                font-size: 13px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .control-btn {
                padding: 7px 4px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>ç»å…¸æ‰«é›·</h1>
            <button class="hint-btn" id="hint-btn">æç¤º</button>
        </div>
        
        <div class="top-controls">
            <div class="difficulty-selector">
                <button class="control-btn difficulty-btn" id="difficulty-toggle">éš¾åº¦: ç®€å•</button>
                <div class="difficulty-dropdown" id="difficulty-dropdown">
                    <div class="difficulty-option active" data-level="easy">ç®€å• (6Ã—12)</div>
                    <div class="difficulty-option" data-level="medium">ä¸­ç­‰ (8Ã—14)</div>
                    <div class="difficulty-option" data-level="hard">å›°éš¾ (10Ã—15)</div>
                </div>
            </div>
            <button class="control-btn reset-btn" id="reset-btn">é‡æ–°å¼€å§‹</button>
            <button class="control-btn history-btn" id="history-toggle">å†å²è®°å½•</button>
        </div>
        
        <div class="game-info">
            <div class="info-item">
                <div class="info-label">å‰©ä½™åœ°é›·</div>
                <div class="info-value" id="mines-count">10</div>
            </div>
            <div class="info-item">
                <div class="info-label">æ—¶é—´</div>
                <div class="info-value" id="timer">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">éš¾åº¦</div>
                <div class="info-value" id="difficulty">ç®€å•</div>
            </div>
        </div>
        
        <div class="game-board-container">
            <div class="game-board" id="game-board"></div>
        </div>
        
        <div class="message" id="message"></div>
        
        <div class="history-panel">
            <div class="history-title">æœ€ä½³è®°å½•</div>
            <div class="best-records" id="best-records">
                <div class="record-item">
                    <span class="record-difficulty">ç®€å•:</span>
                    <span class="record-time" id="best-easy">-</span>
                </div>
                <div class="record-item">
                    <span class="record-difficulty">ä¸­ç­‰:</span>
                    <span class="record-time" id="best-medium">-</span>
                </div>
                <div class="record-item">
                    <span class="record-difficulty">å›°éš¾:</span>
                    <span class="record-time" id="best-hard">-</span>
                </div>
            </div>
        </div>
        
        <!-- å†å²è®°å½•å¼¹çª— -->
        <div class="modal" id="history-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">æ¸¸æˆå†å²è®°å½•</div>
                    <button class="close-btn" id="close-history-modal">Ã—</button>
                </div>
                <div class="history-panel">
                    <div class="best-records">
                        <div class="record-item">
                            <span class="record-difficulty">ç®€å•æœ€ä½³:</span>
                            <span class="record-time" id="modal-best-easy">-</span>
                        </div>
                        <div class="record-item">
                            <span class="record-difficulty">ä¸­ç­‰æœ€ä½³:</span>
                            <span class="record-time" id="modal-best-medium">-</span>
                        </div>
                        <div class="record-item">
                            <span class="record-difficulty">å›°éš¾æœ€ä½³:</span>
                            <span class="record-time" id="modal-best-hard">-</span>
                        </div>
                    </div>
                    
                    <div class="history-title">æ¸¸æˆå†å²</div>
                    <div class="all-records" id="all-records">
                        <!-- å†å²è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                    </div>
                    <button class="clear-history-btn" id="clear-history-btn">æ¸…é™¤æ‰€æœ‰è®°å½•</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€å’Œé…ç½®
        const gameState = {
            board: [],
            rows: 12,  // ä¿®æ­£ï¼šè¡Œæ•°ï¼ˆçºµå‘ï¼‰
            cols: 6,   // ä¿®æ­£ï¼šåˆ—æ•°ï¼ˆæ¨ªå‘ï¼‰
            mineCount: 10,
            revealedCount: 0,
            flaggedCount: 0,
            gameOver: false,
            gameStarted: false,
            timer: 0,
            timerInterval: null,
            currentDifficulty: 'easy',
            firstClick: true,
            startTime: null
        };

        // éš¾åº¦é…ç½®ï¼ˆä¿®æ­£ï¼šè¡Œæ•°åœ¨å‰ï¼Œåˆ—æ•°åœ¨åï¼‰
        const difficultyConfig = {
            easy: { rows: 12, cols: 6, mines: 10 },    // 12è¡Œ6åˆ—
            medium: { rows: 14, cols: 8, mines: 30 },   // 14è¡Œ8åˆ—
            hard: { rows: 15, cols: 10, mines: 50 }    // 15è¡Œ10åˆ—
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            clearInterval(gameState.timerInterval);
            gameState.timer = 0;
            gameState.gameOver = false;
            gameState.gameStarted = false;
            gameState.revealedCount = 0;
            gameState.flaggedCount = 0;
            gameState.firstClick = true;
            gameState.startTime = null;
            
            document.getElementById('timer').textContent = '0';
            document.getElementById('mines-count').textContent = gameState.mineCount.toString();
            document.getElementById('message').className = 'message';
            document.getElementById('message').textContent = '';
            
            createBoard();
            updateBestRecords();
        }

        // åˆ›å»ºæ¸¸æˆæ£‹ç›˜
        function createBoard() {
            const boardElement = document.getElementById('game-board');
            boardElement.innerHTML = '';
            boardElement.style.gridTemplateColumns = `repeat(${gameState.cols}, 1fr)`;
            
            // è®¾ç½®æ£‹ç›˜å¤§å°
            const cellSize = 40; // æ ¼å­å¤§å°
            const gap = 3; // æ ¼å­é—´è·
            const padding = 20; // å†…è¾¹è·
            const boardWidth = gameState.cols * cellSize + (gameState.cols - 1) * gap + padding * 2;
            boardElement.style.width = `${boardWidth}px`;
            
            gameState.board = [];
            const totalCells = gameState.rows * gameState.cols;
            
            // åˆå§‹åŒ–æ£‹ç›˜æ•°æ®
            for (let i = 0; i < gameState.rows; i++) {
                for (let j = 0; j < gameState.cols; j++) {
                    const index = i * gameState.cols + j;
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    cell.addEventListener('click', () => handleCellClick(i, j));
                    
                    // æ·»åŠ å³é”®/é•¿æŒ‰äº‹ä»¶ï¼ˆæ ‡è®°åœ°é›·ï¼‰
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(i, j);
                    });
                    
                    boardElement.appendChild(cell);
                    
                    // åˆå§‹åŒ–æ£‹ç›˜æ•°æ®
                    if (index < totalCells) {
                        gameState.board[index] = {
                            isMine: false,
                            isRevealed: false,
                            isFlagged: false,
                            neighborMines: 0
                        };
                    }
                }
            }
        }

        // æ”¾ç½®åœ°é›·ï¼ˆç¡®ä¿ç¬¬ä¸€æ¬¡ç‚¹å‡»ä¸æ˜¯åœ°é›·ï¼‰
        function placeMines(firstClickRow, firstClickCol) {
            let minesPlaced = 0;
            const totalCells = gameState.rows * gameState.cols;
            
            // åˆ›å»ºå®‰å…¨åŒºåŸŸï¼ˆç¬¬ä¸€æ¬¡ç‚¹å‡»åŠå…¶å‘¨å›´8æ ¼ï¼‰
            const safeCells = new Set();
            for (let i = Math.max(0, firstClickRow - 1); i <= Math.min(gameState.rows - 1, firstClickRow + 1); i++) {
                for (let j = Math.max(0, firstClickCol - 1); j <= Math.min(gameState.cols - 1, firstClickCol + 1); j++) {
                    safeCells.add(i * gameState.cols + j);
                }
            }
            
            while (minesPlaced < gameState.mineCount && minesPlaced < totalCells - safeCells.size) {
                const randomIndex = Math.floor(Math.random() * totalCells);
                
                // ç¡®ä¿ä¸åœ¨å®‰å…¨åŒºåŸŸå†…
                if (safeCells.has(randomIndex)) continue;
                
                if (!gameState.board[randomIndex].isMine) {
                    gameState.board[randomIndex].isMine = true;
                    minesPlaced++;
                }
            }
            
            // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°
            for (let i = 0; i < gameState.rows; i++) {
                for (let j = 0; j < gameState.cols; j++) {
                    const index = i * gameState.cols + j;
                    if (!gameState.board[index].isMine) {
                        gameState.board[index].neighborMines = countAdjacentMines(i, j);
                    }
                }
            }
        }

        // è®¡ç®—ç›¸é‚»åœ°é›·æ•°
        function countAdjacentMines(row, col) {
            let count = 0;
            
            for (let i = Math.max(0, row - 1); i <= Math.min(gameState.rows - 1, row + 1); i++) {
                for (let j = Math.max(0, col - 1); j <= Math.min(gameState.cols - 1, col + 1); j++) {
                    if (i === row && j === col) continue;
                    
                    const index = i * gameState.cols + j;
                    if (gameState.board[index] && gameState.board[index].isMine) {
                        count++;
                    }
                }
            }
            
            return count;
        }

        // å¤„ç†æ ¼å­ç‚¹å‡»
        function handleCellClick(row, col) {
            if (gameState.gameOver) return;
            
            const index = row * gameState.cols + col;
            const cellData = gameState.board[index];
            const cellElement = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            
            if (!cellData || cellData.isRevealed || cellData.isFlagged) return;
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œæ”¾ç½®åœ°é›·å¹¶å¼€å§‹æ¸¸æˆ
            if (gameState.firstClick) {
                gameState.firstClick = false;
                gameState.gameStarted = true;
                gameState.startTime = Date.now();
                placeMines(row, col);
                startTimer();
            }
            
            if (cellData.isMine) {
                // ç‚¹åˆ°åœ°é›·ï¼Œæ¸¸æˆç»“æŸ
                gameOver(false);
                cellElement.classList.add('mine', 'revealed');
                return;
            }
            
            revealCell(row, col);
            
            // æ£€æŸ¥æ˜¯å¦è·èƒœ
            if (gameState.revealedCount === gameState.rows * gameState.cols - gameState.mineCount) {
                gameOver(true);
            }
        }

        // å¤„ç†å³é”®ç‚¹å‡»ï¼ˆæ ‡è®°åœ°é›·ï¼‰
        function handleRightClick(row, col) {
            if (gameState.gameOver || !gameState.gameStarted) return;
            
            const index = row * gameState.cols + col;
            const cellData = gameState.board[index];
            const cellElement = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            
            if (!cellData || cellData.isRevealed) return;
            
            if (cellData.isFlagged) {
                // å–æ¶ˆæ ‡è®°
                cellData.isFlagged = false;
                cellElement.classList.remove('flagged');
                gameState.flaggedCount--;
            } else {
                // æ ‡è®°åœ°é›·
                cellData.isFlagged = true;
                cellElement.classList.add('flagged');
                gameState.flaggedCount++;
            }
            
            document.getElementById('mines-count').textContent = (gameState.mineCount - gameState.flaggedCount).toString();
        }

        // æ­ç¤ºæ ¼å­
        function revealCell(row, col) {
            const index = row * gameState.cols + col;
            const cellData = gameState.board[index];
            const cellElement = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            
            if (!cellData || cellData.isRevealed || cellData.isFlagged) return;
            
            cellData.isRevealed = true;
            cellElement.classList.add('revealed');
            gameState.revealedCount++;
            
            if (cellData.neighborMines > 0) {
                cellElement.textContent = cellData.neighborMines;
                cellElement.classList.add(`number-${cellData.neighborMines}`);
            } else {
                // å¦‚æœæ˜¯ç©ºç™½æ ¼å­ï¼Œé€’å½’æ­ç¤ºå‘¨å›´çš„æ ¼å­
                for (let i = Math.max(0, row - 1); i <= Math.min(gameState.rows - 1, row + 1); i++) {
                    for (let j = Math.max(0, col - 1); j <= Math.min(gameState.cols - 1, col + 1); j++) {
                        if (i === row && j === col) continue;
                        const neighborIndex = i * gameState.cols + j;
                        if (gameState.board[neighborIndex] && !gameState.board[neighborIndex].isRevealed && !gameState.board[neighborIndex].isFlagged) {
                            revealCell(i, j);
                        }
                    }
                }
            }
        }

        // æ¸¸æˆç»“æŸ
        function gameOver(isWin) {
            gameState.gameOver = true;
            gameState.gameStarted = false;
            clearInterval(gameState.timerInterval);
            
            // è®¡ç®—å®é™…æ¸¸æˆæ—¶é—´
            if (gameState.startTime) {
                const endTime = Date.now();
                gameState.timer = Math.floor((endTime - gameState.startTime) / 1000);
                document.getElementById('timer').textContent = gameState.timer.toString();
            }
            
            const messageElement = document.getElementById('message');
            if (isWin) {
                messageElement.textContent = `æ­å–œä½ èµ¢äº†ï¼ç”¨æ—¶ ${gameState.timer} ç§’`;
                messageElement.className = 'message success';
                saveGameResult(true);
            } else {
                messageElement.textContent = 'æ¸¸æˆç»“æŸï¼ä½ è¸©åˆ°åœ°é›·äº†';
                messageElement.className = 'message failure';
                // å¤±è´¥æ—¶ä¸ä¿å­˜è®°å½•
                revealAllMines();
            }
            
            updateBestRecords();
        }

        // æ­ç¤ºæ‰€æœ‰åœ°é›·
        function revealAllMines() {
            for (let i = 0; i < gameState.rows; i++) {
                for (let j = 0; j < gameState.cols; j++) {
                    const index = i * gameState.cols + j;
                    const cellData = gameState.board[index];
                    const cellElement = document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`);
                    
                    if (cellData && cellData.isMine && !cellData.isFlagged) {
                        cellElement.classList.add('mine', 'revealed');
                    } else if (cellData && !cellData.isMine && cellData.isFlagged) {
                        // é”™è¯¯æ ‡è®°çš„åœ°é›·
                        cellElement.classList.add('flagged', 'revealed');
                        cellElement.style.color = '#ff0000';
                    }
                }
            }
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timer = 0;
            document.getElementById('timer').textContent = '0';
            
            gameState.timerInterval = setInterval(() => {
                if (gameState.startTime) {
                    const currentTime = Date.now();
                    gameState.timer = Math.floor((currentTime - gameState.startTime) / 1000);
                    document.getElementById('timer').textContent = gameState.timer.toString();
                }
            }, 100);
        }

        // ä¿å­˜æ¸¸æˆç»“æœï¼ˆåªåœ¨è·èƒœæ—¶ä¿å­˜ï¼‰
        function saveGameResult(isWin) {
            if (!isWin) return; // å¤±è´¥æ—¶ä¸ä¿å­˜è®°å½•
            
            const gameHistory = JSON.parse(localStorage.getItem('minesweeperHistory')) || [];
            const gameRecord = {
                difficulty: gameState.currentDifficulty,
                time: gameState.timer,
                date: new Date().toLocaleDateString('zh-CN'),
                timestamp: Date.now(),
                isWin: true
            };
            
            gameHistory.push(gameRecord);
            localStorage.setItem('minesweeperHistory', JSON.stringify(gameHistory));
        }

        // æ¸…é™¤å†å²è®°å½•
        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ¸¸æˆè®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                localStorage.removeItem('minesweeperHistory');
                updateBestRecords();
                updateGameHistoryModal();
            }
        }

        // æ›´æ–°æœ€ä½³è®°å½•
        function updateBestRecords() {
            const gameHistory = JSON.parse(localStorage.getItem('minesweeperHistory')) || [];
            const bestRecords = {
                easy: null,
                medium: null,
                hard: null
            };
            
            // åªå¤„ç†è·èƒœè®°å½•
            const winRecords = gameHistory.filter(record => record.isWin);
            
            // æ‰¾å‡ºæ¯ä¸ªéš¾åº¦çš„æœ€ä½³è®°å½•
            winRecords.forEach(record => {
                if (record.difficulty in bestRecords) {
                    if (!bestRecords[record.difficulty] || record.time < bestRecords[record.difficulty].time) {
                        bestRecords[record.difficulty] = record;
                    }
                }
            });
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('best-easy').textContent = 
                bestRecords.easy ? `${bestRecords.easy.time}ç§’` : '-';
            document.getElementById('best-medium').textContent = 
                bestRecords.medium ? `${bestRecords.medium.time}ç§’` : '-';
            document.getElementById('best-hard').textContent = 
                bestRecords.hard ? `${bestRecords.hard.time}ç§’` : '-';
            
            // æ›´æ–°å¼¹çª—ä¸­çš„æœ€ä½³è®°å½•
            document.getElementById('modal-best-easy').textContent = 
                bestRecords.easy ? `${bestRecords.easy.time}ç§’ (${bestRecords.easy.date})` : '-';
            document.getElementById('modal-best-medium').textContent = 
                bestRecords.medium ? `${bestRecords.medium.time}ç§’ (${bestRecords.medium.date})` : '-';
            document.getElementById('modal-best-hard').textContent = 
                bestRecords.hard ? `${bestRecords.hard.time}ç§’ (${bestRecords.hard.date})` : '-';
        }

        // æ›´æ–°å¼¹çª—ä¸­çš„æ¸¸æˆå†å²
        function updateGameHistoryModal() {
            const gameHistory = JSON.parse(localStorage.getItem('minesweeperHistory')) || [];
            const allRecordsElement = document.getElementById('all-records');
            
            // æ¸…ç©ºç°æœ‰è®°å½•
            allRecordsElement.innerHTML = '';
            
            // åªæ˜¾ç¤ºè·èƒœè®°å½•
            const winRecords = gameHistory.filter(record => record.isWin);
            
            if (winRecords.length === 0) {
                allRecordsElement.innerHTML = '<div class="record-item">æš‚æ— æ¸¸æˆè®°å½•</div>';
                return;
            }
            
            // æŒ‰æ—¶é—´æˆ³æ’åºï¼Œæœ€æ–°çš„åœ¨å‰é¢
            const sortedHistory = winRecords.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)).slice(0, 10);
            
            sortedHistory.forEach(record => {
                const recordElement = document.createElement('div');
                recordElement.className = 'record-item';
                recordElement.innerHTML = `
                    <span class="record-difficulty">${getDifficultyText(record.difficulty)}</span>
                    <span class="record-time">${record.time}ç§’ (${record.date})</span>
                `;
                allRecordsElement.appendChild(recordElement);
            });
        }

        // è·å–éš¾åº¦æ–‡æœ¬
        function getDifficultyText(difficulty) {
            const difficultyMap = {
                easy: 'ç®€å•',
                medium: 'ä¸­ç­‰',
                hard: 'å›°éš¾'
            };
            return difficultyMap[difficulty] || difficulty;
        }

        // æç¤ºåŠŸèƒ½
        function provideHint() {
            if (!gameState.gameStarted || gameState.gameOver) return;
            
            // å¯»æ‰¾ä¸€ä¸ªæœªæ­ç¤ºä¸”ä¸æ˜¯åœ°é›·çš„æ ¼å­
            const safeCells = [];
            
            for (let i = 0; i < gameState.rows; i++) {
                for (let j = 0; j < gameState.cols; j++) {
                    const index = i * gameState.cols + j;
                    const cellData = gameState.board[index];
                    
                    if (cellData && !cellData.isRevealed && !cellData.isFlagged && !cellData.isMine) {
                        safeCells.push({row: i, col: j});
                    }
                }
            }
            
            if (safeCells.length > 0) {
                const randomIndex = Math.floor(Math.random() * safeCells.length);
                const hintCell = safeCells[randomIndex];
                
                // çŸ­æš‚é«˜äº®æç¤ºçš„æ ¼å­
                const cellElement = document.querySelector(`.cell[data-row="${hintCell.row}"][data-col="${hintCell.col}"]`);
                const originalBg = cellElement.style.backgroundColor;
                
                cellElement.style.backgroundColor = '#f1c40f';
                
                setTimeout(() => {
                    cellElement.style.backgroundColor = originalBg;
                }, 1000);
            }
        }

        // åˆ‡æ¢éš¾åº¦
        function changeDifficulty(difficulty) {
            gameState.currentDifficulty = difficulty;
            gameState.rows = difficultyConfig[difficulty].rows;
            gameState.cols = difficultyConfig[difficulty].cols;
            gameState.mineCount = difficultyConfig[difficulty].mines;
            
            document.getElementById('difficulty').textContent = getDifficultyText(difficulty);
            document.getElementById('difficulty-toggle').textContent = `éš¾åº¦: ${getDifficultyText(difficulty)}`;
            document.getElementById('mines-count').textContent = gameState.mineCount.toString();
            
            // æ›´æ–°éš¾åº¦é€‰é¡¹çŠ¶æ€
            document.querySelectorAll('.difficulty-option').forEach(option => {
                option.classList.toggle('active', option.dataset.level === difficulty);
            });
            
            // å…³é—­ä¸‹æ‹‰èœå•
            document.getElementById('difficulty-dropdown').classList.remove('show');
            
            initGame();
        }

        // æ˜¾ç¤ºå†å²è®°å½•å¼¹çª—
        function showHistoryModal() {
            updateGameHistoryModal();
            document.getElementById('history-modal').classList.add('show');
        }

        // éšè—å†å²è®°å½•å¼¹çª—
        function hideHistoryModal() {
            document.getElementById('history-modal').classList.remove('show');
        }

        // æ˜¾ç¤ºéš¾åº¦é€‰æ‹©å¼¹çª—
        function showDifficultyModal() {
            document.getElementById('difficulty-modal').classList.add('show');
        }

        // éšè—éš¾åº¦é€‰æ‹©å¼¹çª—
        function hideDifficultyModal() {
            document.getElementById('difficulty-modal').classList.remove('show');
        }

        // äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', () => {
            // éš¾åº¦é€‰æ‹©æŒ‰é’®äº‹ä»¶
            document.getElementById('difficulty-toggle').addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('difficulty-dropdown').classList.toggle('show');
            });
            
            // éš¾åº¦é€‰é¡¹äº‹ä»¶
            document.querySelectorAll('.difficulty-option').forEach(option => {
                option.addEventListener('click', () => {
                    changeDifficulty(option.dataset.level);
                });
            });
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­ä¸‹æ‹‰èœå•
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.difficulty-selector')) {
                    document.getElementById('difficulty-dropdown').classList.remove('show');
                }
            });
            
            // å†å²è®°å½•æŒ‰é’®äº‹ä»¶
            document.getElementById('history-toggle').addEventListener('click', showHistoryModal);
            
            // å…³é—­å†å²è®°å½•å¼¹çª—
            document.getElementById('close-history-modal').addEventListener('click', hideHistoryModal);
            
            // æç¤ºæŒ‰é’®äº‹ä»¶
            document.getElementById('hint-btn').addEventListener('click', provideHint);
            
            // é‡æ–°å¼€å§‹æŒ‰é’®äº‹ä»¶
            document.getElementById('reset-btn').addEventListener('click', initGame);
            
            // æ¸…é™¤å†å²è®°å½•æŒ‰é’®äº‹ä»¶
            document.getElementById('clear-history-btn').addEventListener('click', clearHistory);
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­å¼¹çª—
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('show');
                }
            });
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
            updateBestRecords();
        });
    </script>
</body>
</html>

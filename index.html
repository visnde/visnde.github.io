<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç»å…¸æ¸¸æˆå¤§å…¨</title>
    <style>
        /* å…¨å±€æ ·å¼ - ä¿æŒåŸæ · */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* æ–°å¢ï¼šç¦æ­¢ iOS é•¿æŒ‰é€‰ä¸­å’Œç‚¹å‡»é«˜äº® */
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            /* é€‚é… iOS å®‰å…¨åŒºåŸŸ */
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .description {
            font-size: 1.1rem;
            color: #7f8c8d;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* å¯¼èˆªæ ‡ç­¾æ ·å¼ - ä¿æŒåŸæ · */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: #ecf0f1;
            border: none;
            outline: none;
            cursor: pointer;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            color: #34495e;
            transition: all 0.3s ease;
        }
        
        .nav-tab:hover {
            background: #d5dbdb;
        }
        
        .nav-tab.active {
            background: #3498db;
            color: white;
        }
        
        /* é¡µé¢å†…å®¹ */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* æ¸¸æˆåˆ—è¡¨é¡µé¢ - ä¿æŒåŸæ · */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }
        
        .game-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .game-image {
            height: 160px;
            background-color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .game-info {
            padding: 20px;
        }
        
        .game-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .game-description {
            color: #7f8c8d;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        
        .play-button {
            display: inline-block;
            padding: 8px 20px;
            background: #3498db;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .play-button:hover {
            background: #2980b9;
        }
        
        /* æˆ‘çš„é¡µé¢æ ·å¼ - ä¿æŒåŸæ · */
        .profile-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .profile-name {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #2c3e50;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .profile-name:hover {
            color: #3498db;
        }
        
        .name-input {
            display: none;
            width: 100%;
            max-width: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1.2rem;
            text-align: center;
            margin: 0 auto 10px;
        }
        
        .name-input.editing {
            display: block;
        }
        
        .save-name-btn {
            display: none;
            padding: 8px 20px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            margin: 0 auto;
        }
        
        .save-name-btn.editing {
            display: block;
        }
        
        .records-list {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .records-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 10px;
        }
        
        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .record-game {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .record-difficulty {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-left: 5px;
        }
        
        .record-time {
            color: #3498db;
            font-weight: 600;
        }
        
        .clear-record-btn {
            padding: 5px 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.3s ease;
        }
        
        .clear-record-btn:hover {
            background: #c0392b;
        }
        
        /* æ¸¸æˆå®¹å™¨ - ä¿æŒåŸæ · */
        .game-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1000;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* iOS æ»šåŠ¨ä¼˜åŒ– */
        }
        
        .game-container.active {
            display: block;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #3498db;
            color: white;
            /* ä¿æŒå¤´éƒ¨åœ¨ç§»åŠ¨ç«¯å›ºå®š */
            position: sticky; 
            top: 0;
            z-index: 1005;
        }
        
        .game-title-large {
            font-size: 1.8rem;
            color: white;
            font-weight: bold;
        }
        
        .back-button {
            padding: 8px 15px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .game-content {
            padding: 15px;
            max-width: 500px;
            margin: 0 auto;
            /* é˜²æ­¢åº•éƒ¨å†…å®¹è¢«é®æŒ¡ */
            padding-bottom: 50px;
        }
        
        /* æ‰«é›·æ¸¸æˆæ ·å¼ - ä¿æŒåŸæ · */
        .minesweeper-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .minesweeper-info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .minesweeper-info-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .minesweeper-info-value {
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .minesweeper-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
            justify-content: space-between;
        }
        
        .minesweeper-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex: 1;
            text-align: center;
        }
        
        .minesweeper-btn:active {
            transform: translateY(1px);
        }
        
        .minesweeper-difficulty-btn {
            background: #3498db;
            color: white;
            position: relative;
        }
        
        .minesweeper-difficulty-selector {
            position: relative;
            flex: 1;
        }
        
        .minesweeper-difficulty-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            display: none;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .minesweeper-difficulty-dropdown.show {
            display: block;
        }
        
        .minesweeper-difficulty-option {
            padding: 10px;
            cursor: pointer;
            transition: background 0.2s;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .minesweeper-difficulty-option:last-child {
            border-bottom: none;
        }
        
        .minesweeper-difficulty-option:hover {
            background: #f0f0f0;
        }
        
        .minesweeper-difficulty-option.active {
            background: #3498db;
            color: white;
        }
        
        .minesweeper-reset-btn {
            background: #e74c3c;
            color: white;
        }
        
        .minesweeper-hint-btn {
            background: #f39c12;
            color: white;
        }
        
        .minesweeper-board-container {
            width: 100%;
            overflow: visible; /* ä¿®æ”¹ä¸º visible ä»¥å…è®¸æ°”æ³¡æ˜¾ç¤º */
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            position: relative; /* ä¸ºæ°”æ³¡å®šä½ */
        }
        
        .minesweeper-board {
            display: grid;
            gap: 3px;
            background: #1b5e20;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .minesweeper-cell {
            width: 35px;
            height: 35px;
            background: #a5d6a7;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border-radius: 3px;
            user-select: none;
            transition: all 0.1s;
            font-size: 16px;
        }
        
        .minesweeper-cell:active {
            transform: scale(0.95);
        }
        
        .minesweeper-cell.revealed {
            background: #d7ccc8;
        }
        
        .minesweeper-cell.flagged::before {
            content: "âš‘";
            color: #e74c3c;
            font-size: 1.2rem;
        }
        
        .minesweeper-cell.mine {
            background: #e74c3c;
            color: white;
        }
        
        .minesweeper-cell.mine::before {
            content: "ğŸ’£";
        }
        
        .minesweeper-number-1 { color: #3498db; }
        .minesweeper-number-2 { color: #2ecc71; }
        .minesweeper-number-3 { color: #e74c3c; }
        .minesweeper-number-4 { color: #9b59b6; }
        .minesweeper-number-5 { color: #e67e22; }
        .minesweeper-number-6 { color: #1abc9c; }
        .minesweeper-number-7 { color: #34495e; }
        .minesweeper-number-8 { color: #7f8c8d; }
        
        .minesweeper-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .minesweeper-message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        
        .minesweeper-message.failure {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        /* === æ–°å¢ï¼šæ°”æ³¡èœå•æ ·å¼ === */
        .action-bubble {
            position: absolute;
            display: none;
            background: white;
            border-radius: 50px;
            padding: 5px 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 2000;
            gap: 15px;
            align-items: center;
            /* æ°”æ³¡å‡ºç°åŠ¨ç”» */
            animation: bubblePop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            /* å°†æ°”æ³¡å‘ä¸Šåç§» */
            transform: translate(-50%, -140%);
        }
        
        .action-bubble::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 8px 8px 0;
            border-style: solid;
            border-color: white transparent transparent transparent;
        }

        @keyframes bubblePop {
            from { opacity: 0; transform: translate(-50%, -100%) scale(0.5); }
            to { opacity: 1; transform: translate(-50%, -140%) scale(1); }
        }

        .action-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.1s;
        }

        .action-btn:active {
            background-color: #f0f0f0;
        }

        /* å†å²è®°å½•å¼¹çª—æ ·å¼ - ä¿æŒåŸæ · */
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .history-modal.show {
            display: flex;
        }
        
        .history-modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .history-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 10px;
        }
        
        .history-modal-title {
            font-size: 1.3rem;
            color: #2c3e50;
            font-weight: bold;
        }
        
        .history-modal-close {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .history-time {
            color: #7f8c8d;
        }
        
        .clear-all-history {
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
        }
        
        /* å“åº”å¼è®¾è®¡ - ä¿æŒåŸæ · */
        @media (max-width: 768px) {
            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .minesweeper-cell {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 480px) {
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .minesweeper-cell {
                width: 28px;
                height: 28px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç»å…¸æ¸¸æˆå¤§å…¨</h1>
            <p class="description">é‡æ¸©ç»å…¸ï¼Œä½“éªŒä¹è¶£ï¼ç²¾é€‰å¤šæ¬¾ç»å…¸æ¸¸æˆï¼Œæ— éœ€ä¸‹è½½ï¼Œåœ¨çº¿ç•…ç©ã€‚</p>
        </header>
        
        <div class="nav-tabs">
            <div class="nav-tab active" data-page="games-page">æ¸¸æˆ</div>
            <div class="nav-tab" data-page="profile-page">æˆ‘çš„</div>
        </div>
        
        <div id="games-page" class="page active">
            <div class="games-grid">
                <div class="game-card" data-game="minesweeper">
                    <div class="game-image" style="background-color: #3498db;">ğŸ’£</div>
                    <div class="game-info">
                        <h3 class="game-title">æ‰«é›·</h3>
                        <p class="game-description">ç»å…¸çš„é€»è¾‘æ¨ç†æ¸¸æˆï¼Œé€šè¿‡æ•°å­—æç¤ºæ‰¾å‡ºæ‰€æœ‰åœ°é›·ã€‚</p>
                        <a class="play-button">å¼€å§‹æ¸¸æˆ</a>
                    </div>
                </div>
                
                <div class="game-card" data-game="snake">
                    <div class="game-image" style="background-color: #2ecc71;">ğŸ</div>
                    <div class="game-info">
                        <h3 class="game-title">è´ªåƒè›‡</h3>
                        <p class="game-description">æ§åˆ¶è›‡åƒé£Ÿç‰©å˜é•¿ï¼Œå°å¿ƒä¸è¦æ’åˆ°è‡ªå·±ï¼</p>
                        <a class="play-button">å¼€å§‹æ¸¸æˆ</a>
                    </div>
                </div>
                
                <div class="game-card" data-game="tetris">
                    <div class="game-image" style="background-color: #9b59b6;">ğŸ§©</div>
                    <div class="game-info">
                        <h3 class="game-title">ä¿„ç½—æ–¯æ–¹å—</h3>
                        <p class="game-description">ç»å…¸æ¶ˆé™¤æ¸¸æˆï¼Œåˆç†å®‰æ’ä¸‹è½çš„æ–¹å—ã€‚</p>
                        <a class="play-button">å¼€å§‹æ¸¸æˆ</a>
                    </div>
                </div>
                
                <div class="game-card" data-game="2048">
                    <div class="game-image" style="background-color: #e67e22;">ğŸ”¢</div>
                    <div class="game-info">
                        <h3 class="game-title">2048</h3>
                        <p class="game-description">æ»‘åŠ¨åˆå¹¶ç›¸åŒæ•°å­—ï¼ŒåŠªåŠ›è¾¾åˆ°2048æ–¹å—ï¼</p>
                        <a class="play-button">å¼€å§‹æ¸¸æˆ</a>
                    </div>
                </div>
                
                <div class="game-card" data-game="crossy-road">
                    <div class="game-image" style="background-color: #1abc9c;">ğŸš¶</div>
                    <div class="game-info">
                        <h3 class="game-title">è¿‡é©¬è·¯</h3>
                        <p class="game-description">å®‰å…¨ç©¿è¶Šé©¬è·¯ï¼Œé¿å¼€éšœç¢ç‰©ã€‚</p>
                        <a class="play-button">å¼€å§‹æ¸¸æˆ</a>
                    </div>
                </div>
                
                <div class="game-card" data-game="memory">
                    <div class="game-image" style="background-color: #d35400;">ğŸ§ </div>
                    <div class="game-info">
                        <h3 class="game-title">è®°å¿†é…å¯¹</h3>
                        <p class="game-description">ç¿»å¼€å¡ç‰‡å¯»æ‰¾åŒ¹é…å¯¹ï¼Œæµ‹è¯•ä½ çš„è®°å¿†åŠ›ã€‚</p>
                        <a class="play-button">å¼€å§‹æ¸¸æˆ</a>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="profile-page" class="page">
            <div class="profile-section">
                <div class="profile-name" id="profile-name">ç©å®¶</div>
                <input type="text" class="name-input" id="name-input" placeholder="è¾“å…¥æ˜µç§°">
                <button class="save-name-btn" id="save-name-btn">ä¿å­˜</button>
            </div>
            
            <div class="records-list">
                <div class="records-title">æ¸¸æˆè®°å½•</div>
                <div id="records-container">
                    </div>
            </div>
        </div>
    </div>
    
    <div class="game-container" id="minesweeper-game">
        <div class="game-header">
            <button class="back-button">è¿”å›æ¸¸æˆåˆ—è¡¨</button>
            <div class="game-title-large">æ‰«é›·</div>
            <div></div> </div>
        
        <div class="game-content">
            <div class="minesweeper-info">
                <div class="minesweeper-info-item">
                    <div class="minesweeper-info-label">å‰©ä½™åœ°é›·</div>
                    <div class="minesweeper-info-value" id="mines-count">10</div>
                </div>
                <div class="minesweeper-info-item">
                    <div class="minesweeper-info-label">æ—¶é—´</div>
                    <div class="minesweeper-info-value" id="timer">0</div>
                </div>
                <div class="minesweeper-info-item">
                    <div class="minesweeper-info-label">éš¾åº¦</div>
                    <div class="minesweeper-info-value" id="difficulty">ç®€å•</div>
                </div>
            </div>
            
            <div class="minesweeper-controls">
                <div class="minesweeper-difficulty-selector">
                    <button class="minesweeper-btn minesweeper-difficulty-btn" id="difficulty-toggle">éš¾åº¦: ç®€å•</button>
                    <div class="minesweeper-difficulty-dropdown" id="difficulty-dropdown">
                        <div class="minesweeper-difficulty-option active" data-level="easy">ç®€å• (6Ã—12)</div>
                        <div class="minesweeper-difficulty-option" data-level="medium">ä¸­ç­‰ (8Ã—14)</div>
                        <div class="minesweeper-difficulty-option" data-level="hard">å›°éš¾ (10Ã—15)</div>
                    </div>
                </div>
                <button class="minesweeper-btn minesweeper-reset-btn" id="reset-btn">é‡æ–°å¼€å§‹</button>
                <button class="minesweeper-btn minesweeper-hint-btn" id="hint-btn">æç¤º</button>
            </div>
            
            <div class="minesweeper-board-container" id="board-container">
                <div class="minesweeper-board" id="game-board"></div>
                
                <div class="action-bubble" id="action-bubble">
                    <button class="action-btn" id="action-shovel" style="color: #2ecc71;" title="æŒ–å¼€">â›ï¸</button>
                    <button class="action-btn" id="action-flag" style="color: #e74c3c;" title="æ ‡è®°">ğŸš©</button>
                    <button class="action-btn" id="action-close" style="color: #95a5a6;" title="å–æ¶ˆ">âŒ</button>
                </div>
            </div>
            
            <div class="minesweeper-message" id="message"></div>
        </div>
    </div>
    
    <div class="history-modal" id="minesweeper-history-modal">
        <div class="history-modal-content">
            <div class="history-modal-header">
                <div class="history-modal-title">æ‰«é›·æ¸¸æˆå†å²</div>
                <button class="history-modal-close" id="close-history-modal">Ã—</button>
            </div>
            <div class="history-list" id="minesweeper-history-list">
                </div>
            <button class="clear-all-history" id="clear-minesweeper-history">æ¸…é™¤æ‰«é›·å†å²è®°å½•</button>
        </div>
    </div>

    <script>
        // åº”ç”¨çŠ¶æ€ç®¡ç†
        const appState = {
            currentPage: 'games-page',
            currentGame: null,
            playerName: localStorage.getItem('playerName') || 'ç©å®¶',
            gameRecords: JSON.parse(localStorage.getItem('gameRecords')) || {},
            minesweeperHistory: JSON.parse(localStorage.getItem('minesweeperHistory')) || []
        };
        
        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            // è®¾ç½®ç©å®¶åç§°
            document.getElementById('profile-name').textContent = appState.playerName;
            
            // åŠ è½½æ¸¸æˆè®°å½•
            loadGameRecords();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬
            setupEventListeners();
        });
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // å¯¼èˆªæ ‡ç­¾ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const pageId = tab.dataset.page;
                    switchPage(pageId);
                });
            });
            
            // æ¸¸æˆå¡ç‰‡ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.game-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (e.target.classList.contains('play-button')) {
                        const gameId = card.dataset.game;
                        openGame(gameId);
                    }
                });
            });
            
            // è¿”å›æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.back-button').forEach(button => {
                button.addEventListener('click', closeGame);
            });
            
            // ç©å®¶åç§°ç¼–è¾‘äº‹ä»¶
            document.getElementById('profile-name').addEventListener('click', startNameEditing);
            document.getElementById('save-name-btn').addEventListener('click', savePlayerName);
            
            // å…³é—­å†å²è®°å½•å¼¹çª—
            document.getElementById('close-history-modal').addEventListener('click', closeMinesweeperHistory);
            
            // æ¸…é™¤æ‰«é›·å†å²è®°å½•
            document.getElementById('clear-minesweeper-history').addEventListener('click', clearMinesweeperHistory);
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå–æ¶ˆåç§°ç¼–è¾‘
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.profile-section')) {
                    cancelNameEditing();
                }
            });
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­å†å²è®°å½•å¼¹çª—
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('history-modal')) {
                    closeMinesweeperHistory();
                }
            });
        }
        
        // åˆ‡æ¢é¡µé¢
        function switchPage(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(pageId).classList.add('active');
            
            // æ›´æ–°å¯¼èˆªæ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.page === pageId);
            });
            
            appState.currentPage = pageId;
            
            // å¦‚æœæ˜¯"æˆ‘çš„"é¡µé¢ï¼Œé‡æ–°åŠ è½½è®°å½•
            if (pageId === 'profile-page') {
                loadGameRecords();
            }
        }
        
        // æ‰“å¼€æ¸¸æˆ
        function openGame(gameId) {
            appState.currentGame = gameId;
            
            // éšè—æ‰€æœ‰æ¸¸æˆå®¹å™¨
            document.querySelectorAll('.game-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // éšè—æ¸¸æˆåˆ—è¡¨
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ¸¸æˆ
            document.getElementById(`${gameId}-game`).classList.add('active');
            
            // åˆå§‹åŒ–æ¸¸æˆ
            if (gameId === 'minesweeper') {
                initMinesweeper();
            }
        }
        
        // å…³é—­æ¸¸æˆ
        function closeGame() {
            // éšè—æ‰€æœ‰æ¸¸æˆå®¹å™¨
            document.querySelectorAll('.game-container').forEach(container => {
                container.classList.remove('active');
            });
            
            // æ˜¾ç¤ºæ¸¸æˆåˆ—è¡¨
            document.getElementById('games-page').classList.add('active');
            
            appState.currentGame = null;
            
            // é‡æ–°åŠ è½½æ¸¸æˆè®°å½•
            loadGameRecords();
        }
        
        // å¼€å§‹ç¼–è¾‘ç©å®¶åç§°
        function startNameEditing() {
            document.getElementById('profile-name').style.display = 'none';
            document.getElementById('name-input').classList.add('editing');
            document.getElementById('save-name-btn').classList.add('editing');
            
            document.getElementById('name-input').value = appState.playerName;
            document.getElementById('name-input').focus();
        }
        
        // ä¿å­˜ç©å®¶åç§°
        function savePlayerName() {
            const newName = document.getElementById('name-input').value.trim() || 'ç©å®¶';
            appState.playerName = newName;
            localStorage.setItem('playerName', newName);
            
            document.getElementById('profile-name').textContent = newName;
            cancelNameEditing();
        }
        
        // å–æ¶ˆåç§°ç¼–è¾‘
        function cancelNameEditing() {
            document.getElementById('profile-name').style.display = 'block';
            document.getElementById('name-input').classList.remove('editing');
            document.getElementById('save-name-btn').classList.remove('editing');
        }
        
        // åŠ è½½æ¸¸æˆè®°å½•
        function loadGameRecords() {
            const recordsContainer = document.getElementById('records-container');
            recordsContainer.innerHTML = '';
            
            // ä»localStorageåŠ è½½è®°å½•
            appState.gameRecords = JSON.parse(localStorage.getItem('gameRecords')) || {};
            appState.minesweeperHistory = JSON.parse(localStorage.getItem('minesweeperHistory')) || [];
            
            // ä¸ºæ¯ä¸ªæ¸¸æˆåˆ›å»ºè®°å½•é¡¹
            const games = [
                { id: 'minesweeper', name: 'æ‰«é›·' },
                { id: 'snake', name: 'è´ªåƒè›‡' },
                { id: 'tetris', name: 'ä¿„ç½—æ–¯æ–¹å—' },
                { id: '2048', name: '2048' },
                { id: 'crossy-road', name: 'è¿‡é©¬è·¯' },
                { id: 'memory', name: 'è®°å¿†é…å¯¹' }
            ];
            
            games.forEach(game => {
                const record = appState.gameRecords[game.id] || { bestTime: 0, played: false, difficulty: '' };
                
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                
                if (record.played) {
                    // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
                    let timeDisplay = '';
                    if (record.bestTime >= 60) {
                        const minutes = Math.floor(record.bestTime / 60);
                        const seconds = record.bestTime % 60;
                        timeDisplay = `${minutes}åˆ†${seconds}ç§’`;
                    } else {
                        timeDisplay = `${record.bestTime}ç§’`;
                    }
                    
                    recordItem.innerHTML = `
                        <div>
                            <span class="record-game">${game.name}</span>
                            <span class="record-difficulty">${record.difficulty ? `(${record.difficulty})` : ''}</span>
                        </div>
                        <div>
                            <button class="clear-record-btn" data-game="${game.id}">æ¸…é™¤</button>
                        </div>
                        <span class="record-time">${timeDisplay}</span>
                    `;
                } else {
                    recordItem.innerHTML = `
                        <span class="record-game">${game.name}</span>
                        <div></div>
                        <span class="record-time">æš‚æ— è®°å½•</span>
                    `;
                }
                
                recordsContainer.appendChild(recordItem);
            });
            
            // æ·»åŠ æ¸…é™¤æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.clear-record-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const gameId = btn.dataset.game;
                    clearGameRecord(gameId);
                });
            });
            
            // æ·»åŠ æ‰«é›·å†å²è®°å½•ç‚¹å‡»äº‹ä»¶
            const minesweeperRecord = document.querySelector('.record-game');
            if (minesweeperRecord && minesweeperRecord.textContent === 'æ‰«é›·') {
                minesweeperRecord.parentElement.parentElement.addEventListener('click', () => {
                    showMinesweeperHistory();
                });
            }
        }
        
        // æ¸…é™¤æ¸¸æˆè®°å½•
        function clearGameRecord(gameId) {
            if (confirm(`ç¡®å®šè¦æ¸…é™¤${getGameName(gameId)}çš„æ¸¸æˆè®°å½•å—ï¼Ÿ`)) {
                if (appState.gameRecords[gameId]) {
                    delete appState.gameRecords[gameId];
                    localStorage.setItem('gameRecords', JSON.stringify(appState.gameRecords));
                    loadGameRecords();
                }
            }
        }
        
        // è·å–æ¸¸æˆåç§°
        function getGameName(gameId) {
            const gameNames = {
                'minesweeper': 'æ‰«é›·',
                'snake': 'è´ªåƒè›‡',
                'tetris': 'ä¿„ç½—æ–¯æ–¹å—',
                '2048': '2048',
                'crossy-road': 'è¿‡é©¬è·¯',
                'memory': 'è®°å¿†é…å¯¹'
            };
            return gameNames[gameId] || gameId;
        }
        
        // ä¿å­˜æ¸¸æˆè®°å½•
        function saveGameRecord(gameId, time, difficulty = '') {
            if (!appState.gameRecords[gameId]) {
                appState.gameRecords[gameId] = { 
                    bestTime: time, 
                    played: true, 
                    difficulty: difficulty,
                    date: new Date().toLocaleDateString('zh-CN')
                };
            } else if (time < appState.gameRecords[gameId].bestTime || appState.gameRecords[gameId].bestTime === 0) {
                appState.gameRecords[gameId].bestTime = time;
                appState.gameRecords[gameId].played = true;
                appState.gameRecords[gameId].difficulty = difficulty;
                appState.gameRecords[gameId].date = new Date().toLocaleDateString('zh-CN');
            } else {
                appState.gameRecords[gameId].played = true;
            }
            
            localStorage.setItem('gameRecords', JSON.stringify(appState.gameRecords));
            loadGameRecords();
        }
        
        // ä¿å­˜æ‰«é›·å†å²è®°å½•
        function saveMinesweeperHistory(time, difficulty) {
            const historyItem = {
                time: time,
                difficulty: difficulty,
                date: new Date().toLocaleString('zh-CN')
            };
            
            appState.minesweeperHistory.unshift(historyItem);
            
            // åªä¿ç•™æœ€è¿‘20æ¡è®°å½•
            if (appState.minesweeperHistory.length > 20) {
                appState.minesweeperHistory = appState.minesweeperHistory.slice(0, 20);
            }
            
            localStorage.setItem('minesweeperHistory', JSON.stringify(appState.minesweeperHistory));
        }
        
        // æ˜¾ç¤ºæ‰«é›·å†å²è®°å½•
        function showMinesweeperHistory() {
            const historyList = document.getElementById('minesweeper-history-list');
            historyList.innerHTML = '';
            
            if (appState.minesweeperHistory.length === 0) {
                historyList.innerHTML = '<div class="history-item">æš‚æ— æ¸¸æˆè®°å½•</div>';
            } else {
                appState.minesweeperHistory.forEach(record => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
                    let timeDisplay = '';
                    if (record.time >= 60) {
                        const minutes = Math.floor(record.time / 60);
                        const seconds = record.time % 60;
                        timeDisplay = `${minutes}åˆ†${seconds}ç§’`;
                    } else {
                        timeDisplay = `${record.time}ç§’`;
                    }
                    
                    historyItem.innerHTML = `
                        <span>${record.date}</span>
                        <span class="history-time">${timeDisplay} (${record.difficulty})</span>
                    `;
                    historyList.appendChild(historyItem);
                });
            }
            
            document.getElementById('minesweeper-history-modal').classList.add('show');
        }
        
        // å…³é—­æ‰«é›·å†å²è®°å½•
        function closeMinesweeperHistory() {
            document.getElementById('minesweeper-history-modal').classList.remove('show');
        }
        
        // æ¸…é™¤æ‰«é›·å†å²è®°å½•
        function clearMinesweeperHistory() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ‰«é›·å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                appState.minesweeperHistory = [];
                localStorage.setItem('minesweeperHistory', JSON.stringify(appState.minesweeperHistory));
                closeMinesweeperHistory();
            }
        }
        
        // æ‰«é›·æ¸¸æˆå®ç°
        function initMinesweeper() {
            // æ‰«é›·æ¸¸æˆçŠ¶æ€å’Œé…ç½®
            const gameState = {
                board: [],
                rows: 12,
                cols: 6,
                mineCount: 10,
                revealedCount: 0,
                flaggedCount: 0,
                gameOver: false,
                gameStarted: false,
                timer: 0,
                timerInterval: null,
                currentDifficulty: 'easy',
                firstClick: true,
                startTime: null,
                selectedCell: null // å½“å‰é€‰ä¸­çš„æ ¼å­
            };

            // éš¾åº¦é…ç½®
            const difficultyConfig = {
                easy: { rows: 12, cols: 6, mines: 10 },
                medium: { rows: 14, cols: 8, mines: 30 },
                hard: { rows: 15, cols: 10, mines: 50 }
            };

            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                clearInterval(gameState.timerInterval);
                gameState.timer = 0;
                gameState.gameOver = false;
                gameState.gameStarted = false;
                gameState.revealedCount = 0;
                gameState.flaggedCount = 0;
                gameState.firstClick = true;
                gameState.startTime = null;
                gameState.selectedCell = null;
                
                document.getElementById('timer').textContent = '0';
                document.getElementById('mines-count').textContent = gameState.mineCount.toString();
                document.getElementById('message').className = 'minesweeper-message';
                document.getElementById('message').textContent = '';
                
                hideBubble();
                createBoard();
            }

            // åˆ›å»ºæ¸¸æˆæ£‹ç›˜
            function createBoard() {
                const boardElement = document.getElementById('game-board');
                boardElement.innerHTML = '';
                boardElement.style.gridTemplateColumns = `repeat(${gameState.cols}, 1fr)`;
                
                // è®¾ç½®æ£‹ç›˜å¤§å°
                const cellSize = 35; // æ ¼å­å¤§å°
                const gap = 3; // æ ¼å­é—´è·
                const padding = 20; // å†…è¾¹è·
                const boardWidth = gameState.cols * cellSize + (gameState.cols - 1) * gap + padding * 2;
                boardElement.style.width = `${boardWidth}px`;
                
                gameState.board = [];
                const totalCells = gameState.rows * gameState.cols;
                
                // åˆå§‹åŒ–æ£‹ç›˜æ•°æ®
                for (let i = 0; i < gameState.rows; i++) {
                    for (let j = 0; j < gameState.cols; j++) {
                        const index = i * gameState.cols + j;
                        const cell = document.createElement('div');
                        cell.className = 'minesweeper-cell';
                        cell.dataset.row = i;
                        cell.dataset.col = j;
                        
                        // ä¿®æ”¹ï¼šå•å‡»äº‹ä»¶å”¤èµ·æ°”æ³¡
                        cell.addEventListener('click', (e) => handleCellClick(e, i, j));
                        
                        // ç¦ç”¨åŸç”Ÿå³é”®èœå•
                        cell.addEventListener('contextmenu', (e) => e.preventDefault());
                        
                        boardElement.appendChild(cell);
                        
                        // åˆå§‹åŒ–æ£‹ç›˜æ•°æ®
                        if (index < totalCells) {
                            gameState.board[index] = {
                                isMine: false,
                                isRevealed: false,
                                isFlagged: false,
                                neighborMines: 0
                            };
                        }
                    }
                }
            }
            
            // æ˜¾ç¤ºæ°”æ³¡èœå•
            function showBubble(targetCell, row, col) {
                const bubble = document.getElementById('action-bubble');
                const boardContainer = document.getElementById('board-container');
                
                // è·å–ç›¸å¯¹åæ ‡è®¡ç®—
                const containerRect = boardContainer.getBoundingClientRect();
                const cellRect = targetCell.getBoundingClientRect();
                
                // è®¡ç®—æ°”æ³¡ä½ç½®ï¼šç›¸å¯¹äºboard-containerå®šä½
                const relativeLeft = cellRect.left - containerRect.left + (cellRect.width / 2);
                const relativeTop = cellRect.top - containerRect.top;
                
                bubble.style.left = `${relativeLeft}px`;
                bubble.style.top = `${relativeTop}px`;
                bubble.style.display = 'flex';
                
                // å­˜å‚¨å½“å‰é€‰ä¸­çš„æ ¼å­
                gameState.selectedCell = { row, col };
            }

            function hideBubble() {
                const bubble = document.getElementById('action-bubble');
                bubble.style.display = 'none';
                gameState.selectedCell = null;
            }

            // å¤„ç†æ ¼å­å•å‡»
            function handleCellClick(e, row, col) {
                if (gameState.gameOver) return;
                
                const index = row * gameState.cols + col;
                const cellData = gameState.board[index];
                
                // å¦‚æœå·²ç»ç¿»å¼€ï¼Œä¸åšæ“ä½œ
                if (cellData.isRevealed) {
                    hideBubble();
                    return;
                }
                
                // å¦‚æœç‚¹å‡»çš„æ˜¯å½“å‰å·²ç»é€‰ä¸­çš„æ ¼å­ï¼Œåˆ™å…³é—­æ°”æ³¡
                if (gameState.selectedCell && gameState.selectedCell.row === row && gameState.selectedCell.col === col) {
                    hideBubble();
                    return;
                }
                
                // é€‰ä¸­è¯¥æ ¼å­å¹¶æ˜¾ç¤ºæ°”æ³¡
                showBubble(e.target, row, col);
            }
            
            // ç»‘å®šæ°”æ³¡æŒ‰é’®äº‹ä»¶
            const shovelBtn = document.getElementById('action-shovel');
            const flagBtn = document.getElementById('action-flag');
            const closeBtn = document.getElementById('action-close');
            
            // ç§»é™¤æ—§çš„ç›‘å¬å™¨ï¼ˆé˜²æ­¢é‡å¤ç»‘å®šï¼‰
            const newShovelBtn = shovelBtn.cloneNode(true);
            const newFlagBtn = flagBtn.cloneNode(true);
            const newCloseBtn = closeBtn.cloneNode(true);
            
            shovelBtn.parentNode.replaceChild(newShovelBtn, shovelBtn);
            flagBtn.parentNode.replaceChild(newFlagBtn, flagBtn);
            closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);
            
            // æŒ–å¼€é€»è¾‘
            newShovelBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!gameState.selectedCell) return;
                
                const { row, col } = gameState.selectedCell;
                const index = row * gameState.cols + col;
                const cellData = gameState.board[index];
                
                // å¦‚æœæ’äº†æ——ï¼Œä¸èƒ½æŒ–
                if (cellData.isFlagged) {
                    hideBubble();
                    return;
                }

                // ç¬¬ä¸€æ¬¡ç‚¹å‡»é€»è¾‘ç§»åˆ°è¿™é‡Œ
                if (gameState.firstClick) {
                    gameState.firstClick = false;
                    gameState.gameStarted = true;
                    gameState.startTime = Date.now();
                    placeMines(row, col);
                    startTimer();
                }

                if (cellData.isMine) {
                    const cellElement = document.querySelector(`.minesweeper-cell[data-row="${row}"][data-col="${col}"]`);
                    gameOver(false);
                    cellElement.classList.add('mine', 'revealed');
                } else {
                    revealCell(row, col);
                    if (gameState.revealedCount === gameState.rows * gameState.cols - gameState.mineCount) {
                        gameOver(true);
                    }
                }
                hideBubble();
            });
            
            // æ’æ——é€»è¾‘
            newFlagBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!gameState.selectedCell) return;
                
                const { row, col } = gameState.selectedCell;
                const index = row * gameState.cols + col;
                const cellData = gameState.board[index];
                const cellElement = document.querySelector(`.minesweeper-cell[data-row="${row}"][data-col="${col}"]`);
                
                if (cellData.isRevealed) return;
                
                if (cellData.isFlagged) {
                    cellData.isFlagged = false;
                    cellElement.classList.remove('flagged');
                    gameState.flaggedCount--;
                } else {
                    cellData.isFlagged = true;
                    cellElement.classList.add('flagged');
                    gameState.flaggedCount++;
                }
                document.getElementById('mines-count').textContent = (gameState.mineCount - gameState.flaggedCount).toString();
                hideBubble();
            });
            
            // å…³é—­é€»è¾‘
            newCloseBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                hideBubble();
            });
            
            // å…¨å±€ç‚¹å‡»å…³é—­æ°”æ³¡
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.minesweeper-cell') && !e.target.closest('.action-bubble')) {
                    hideBubble();
                }
            });

            // æ”¾ç½®åœ°é›·ï¼ˆç¡®ä¿ç¬¬ä¸€æ¬¡ç‚¹å‡»ä¸æ˜¯åœ°é›·ï¼‰
            function placeMines(firstClickRow, firstClickCol) {
                let minesPlaced = 0;
                const totalCells = gameState.rows * gameState.cols;
                
                // åˆ›å»ºå®‰å…¨åŒºåŸŸï¼ˆç¬¬ä¸€æ¬¡ç‚¹å‡»åŠå…¶å‘¨å›´8æ ¼ï¼‰
                const safeCells = new Set();
                for (let i = Math.max(0, firstClickRow - 1); i <= Math.min(gameState.rows - 1, firstClickRow + 1); i++) {
                    for (let j = Math.max(0, firstClickCol - 1); j <= Math.min(gameState.cols - 1, firstClickCol + 1); j++) {
                        safeCells.add(i * gameState.cols + j);
                    }
                }
                
                while (minesPlaced < gameState.mineCount && minesPlaced < totalCells - safeCells.size) {
                    const randomIndex = Math.floor(Math.random() * totalCells);
                    
                    // ç¡®ä¿ä¸åœ¨å®‰å…¨åŒºåŸŸå†…
                    if (safeCells.has(randomIndex)) continue;
                    
                    if (!gameState.board[randomIndex].isMine) {
                        gameState.board[randomIndex].isMine = true;
                        minesPlaced++;
                    }
                }
                
                // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°
                for (let i = 0; i < gameState.rows; i++) {
                    for (let j = 0; j < gameState.cols; j++) {
                        const index = i * gameState.cols + j;
                        if (!gameState.board[index].isMine) {
                            gameState.board[index].neighborMines = countAdjacentMines(i, j);
                        }
                    }
                }
            }

            // è®¡ç®—ç›¸é‚»åœ°é›·æ•°
            function countAdjacentMines(row, col) {
                let count = 0;
                
                for (let i = Math.max(0, row - 1); i <= Math.min(gameState.rows - 1, row + 1); i++) {
                    for (let j = Math.max(0, col - 1); j <= Math.min(gameState.cols - 1, col + 1); j++) {
                        if (i === row && j === col) continue;
                        
                        const index = i * gameState.cols + j;
                        if (gameState.board[index] && gameState.board[index].isMine) {
                            count++;
                        }
                    }
                }
                
                return count;
            }

            // æ­ç¤ºæ ¼å­
            function revealCell(row, col) {
                const index = row * gameState.cols + col;
                const cellData = gameState.board[index];
                const cellElement = document.querySelector(`.minesweeper-cell[data-row="${row}"][data-col="${col}"]`);
                
                if (!cellData || cellData.isRevealed || cellData.isFlagged) return;
                
                cellData.isRevealed = true;
                cellElement.classList.add('revealed');
                gameState.revealedCount++;
                
                if (cellData.neighborMines > 0) {
                    cellElement.textContent = cellData.neighborMines;
                    cellElement.classList.add(`minesweeper-number-${cellData.neighborMines}`);
                } else {
                    // å¦‚æœæ˜¯ç©ºç™½æ ¼å­ï¼Œé€’å½’æ­ç¤ºå‘¨å›´çš„æ ¼å­
                    for (let i = Math.max(0, row - 1); i <= Math.min(gameState.rows - 1, row + 1); i++) {
                        for (let j = Math.max(0, col - 1); j <= Math.min(gameState.cols - 1, col + 1); j++) {
                            if (i === row && j === col) continue;
                            const neighborIndex = i * gameState.cols + j;
                            if (gameState.board[neighborIndex] && !gameState.board[neighborIndex].isRevealed && !gameState.board[neighborIndex].isFlagged) {
                                revealCell(i, j);
                            }
                        }
                    }
                }
            }

            // æ¸¸æˆç»“æŸ
            function gameOver(isWin) {
                gameState.gameOver = true;
                gameState.gameStarted = false;
                clearInterval(gameState.timerInterval);
                
                // è®¡ç®—å®é™…æ¸¸æˆæ—¶é—´
                if (gameState.startTime) {
                    const endTime = Date.now();
                    gameState.timer = Math.floor((endTime - gameState.startTime) / 1000);
                    document.getElementById('timer').textContent = gameState.timer.toString();
                }
                
                const messageElement = document.getElementById('message');
                if (isWin) {
                    messageElement.textContent = `æ­å–œä½ èµ¢äº†ï¼ç”¨æ—¶ ${gameState.timer} ç§’`;
                    messageElement.className = 'minesweeper-message success';
                    // ä¿å­˜æ¸¸æˆè®°å½•
                    saveGameRecord('minesweeper', gameState.timer, getDifficultyText(gameState.currentDifficulty));
                    saveMinesweeperHistory(gameState.timer, getDifficultyText(gameState.currentDifficulty));
                } else {
                    messageElement.textContent = 'æ¸¸æˆç»“æŸï¼ä½ è¸©åˆ°åœ°é›·äº†';
                    messageElement.className = 'minesweeper-message failure';
                    // å¤±è´¥æ—¶ä¸ä¿å­˜è®°å½•
                    revealAllMines();
                }
            }

            // æ­ç¤ºæ‰€æœ‰åœ°é›·
            function revealAllMines() {
                for (let i = 0; i < gameState.rows; i++) {
                    for (let j = 0; j < gameState.cols; j++) {
                        const index = i * gameState.cols + j;
                        const cellData = gameState.board[index];
                        const cellElement = document.querySelector(`.minesweeper-cell[data-row="${i}"][data-col="${j}"]`);
                        
                        if (cellData && cellData.isMine && !cellData.isFlagged) {
                            cellElement.classList.add('mine', 'revealed');
                        } else if (cellData && !cellData.isMine && cellData.isFlagged) {
                            // é”™è¯¯æ ‡è®°çš„åœ°é›·
                            cellElement.classList.add('flagged', 'revealed');
                            cellElement.style.color = '#ff0000';
                        }
                    }
                }
            }

            // å¼€å§‹è®¡æ—¶å™¨
            function startTimer() {
                clearInterval(gameState.timerInterval);
                gameState.timer = 0;
                document.getElementById('timer').textContent = '0';
                
                gameState.timerInterval = setInterval(() => {
                    if (gameState.startTime) {
                        const currentTime = Date.now();
                        gameState.timer = Math.floor((currentTime - gameState.startTime) / 1000);
                        document.getElementById('timer').textContent = gameState.timer.toString();
                    }
                }, 100);
            }

            // æç¤ºåŠŸèƒ½
            function provideHint() {
                if (!gameState.gameStarted || gameState.gameOver) return;
                
                // å¯»æ‰¾ä¸€ä¸ªæœªæ­ç¤ºä¸”ä¸æ˜¯åœ°é›·çš„æ ¼å­
                const safeCells = [];
                
                for (let i = 0; i < gameState.rows; i++) {
                    for (let j = 0; j < gameState.cols; j++) {
                        const index = i * gameState.cols + j;
                        const cellData = gameState.board[index];
                        
                        if (cellData && !cellData.isRevealed && !cellData.isFlagged && !cellData.isMine) {
                            safeCells.push({row: i, col: j});
                        }
                    }
                }
                
                if (safeCells.length > 0) {
                    const randomIndex = Math.floor(Math.random() * safeCells.length);
                    const hintCell = safeCells[randomIndex];
                    
                    // çŸ­æš‚é«˜äº®æç¤ºçš„æ ¼å­
                    const cellElement = document.querySelector(`.minesweeper-cell[data-row="${hintCell.row}"][data-col="${hintCell.col}"]`);
                    const originalBg = cellElement.style.backgroundColor;
                    
                    cellElement.style.backgroundColor = '#f1c40f';
                    
                    setTimeout(() => {
                        cellElement.style.backgroundColor = originalBg;
                    }, 1000);
                }
            }
            
            // è·å–éš¾åº¦æ–‡æœ¬
            function getDifficultyText(difficulty) {
                const difficultyMap = {
                    easy: 'ç®€å•',
                    medium: 'ä¸­ç­‰',
                    hard: 'å›°éš¾'
                };
                return difficultyMap[difficulty] || difficulty;
            }
            
            // åˆ‡æ¢éš¾åº¦
            function changeDifficulty(difficulty) {
                gameState.currentDifficulty = difficulty;
                gameState.rows = difficultyConfig[difficulty].rows;
                gameState.cols = difficultyConfig[difficulty].cols;
                gameState.mineCount = difficultyConfig[difficulty].mines;
                
                document.getElementById('difficulty').textContent = getDifficultyText(difficulty);
                document.getElementById('difficulty-toggle').textContent = `éš¾åº¦: ${getDifficultyText(difficulty)}`;
                document.getElementById('mines-count').textContent = gameState.mineCount.toString();
                
                // æ›´æ–°éš¾åº¦é€‰é¡¹çŠ¶æ€
                document.querySelectorAll('.minesweeper-difficulty-option').forEach(option => {
                    option.classList.toggle('active', option.dataset.level === difficulty);
                });
                
                // å…³é—­ä¸‹æ‹‰èœå•
                document.getElementById('difficulty-dropdown').classList.remove('show');
                
                initGame();
            }
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬
            document.getElementById('difficulty-toggle').addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('difficulty-dropdown').classList.toggle('show');
            });
            
            document.querySelectorAll('.minesweeper-difficulty-option').forEach(option => {
                option.addEventListener('click', () => {
                    changeDifficulty(option.dataset.level);
                });
            });
            
            document.getElementById('hint-btn').addEventListener('click', provideHint);
            document.getElementById('reset-btn').addEventListener('click', initGame);
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­ä¸‹æ‹‰èœå•
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.minesweeper-difficulty-selector')) {
                    document.getElementById('difficulty-dropdown').classList.remove('show');
                }
            });
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
        }
    </script>
</body>
</html>

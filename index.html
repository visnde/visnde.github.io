<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FE3H æˆ˜ç•¥æŒ‡æŒ¥å®˜ç³»ç»Ÿ v3.0</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap');
        :root { --gold: #d4af37; --bg: #0d0d0d; }
        body { font-family: 'Noto Serif SC', serif; background-color: var(--bg); color: #ececec; }
        .fe-border { border: 1px solid var(--gold); }
        .card-gradient { background: linear-gradient(145deg, #1a1a1a, #121212); }
        .house-eagle { border-left: 4px solid #c0392b; }
        .house-lion { border-left: 4px solid #2980b9; }
        .house-deer { border-left: 4px solid #f1c40f; }
        input, select, textarea { background: #222 !important; border: 1px solid #444 !important; color: white !important; padding: 8px; border-radius: 4px; width: 100%; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: var(--gold); }
    </style>
</head>
<body class="custom-scroll">
    <div id="app" class="flex min-h-screen">
        <aside class="w-64 bg-black border-r border-yellow-800/40 fixed h-full z-50">
            <div class="p-8 text-center border-b border-yellow-900/20">
                <h1 class="text-xl font-bold text-yellow-500 tracking-tighter">é£èŠ±é›ªæœˆæ”»ç•¥ç³»ç»Ÿ</h1>
                <p class="text-[10px] text-gray-500 mt-1 uppercase">Strategic Guide v3.0</p>
            </div>
            <nav class="mt-4 custom-scroll overflow-y-auto h-[calc(100vh-150px)]">
                <div v-for="m in menus" :key="m.id" @click="currentTab = m.id"
                     :class="['px-6 py-3 cursor-pointer transition flex items-center gap-3', currentTab === m.id ? 'bg-yellow-900/20 text-yellow-500 border-r-4 border-yellow-500' : 'text-gray-400 hover:text-white']">
                    <span>{{ m.icon }}</span><span class="text-sm font-bold">{{ m.name }}</span>
                </div>
            </nav>
        </aside>

        <main class="ml-64 flex-1 p-8">
            <div class="flex justify-between items-center mb-8 border-b border-yellow-800/30 pb-4">
                <h2 class="text-2xl font-bold">{{ currentMenuName }}</h2>
                <div class="flex gap-4">
                    <input v-if="!['profile', 'backup'].includes(currentTab)" v-model="searchQuery" placeholder="æœç´¢è§’è‰²/å­¦çº§..." class="rounded-full !w-48 text-xs">
                    <button v-if="!['profile', 'backup'].includes(currentTab)" @click="openModal()" class="bg-yellow-600 text-black px-5 py-2 rounded font-bold text-xs">+ æ–°å¢æ”»ç•¥</button>
                </div>
            </div>

            <section v-if="currentTab === 'profile'" class="grid grid-cols-1 md:grid-cols-3 gap-6 animate-fadeIn">
                <div class="bg-zinc-900 p-6 fe-border rounded col-span-1">
                    <h3 class="text-yellow-500 mb-4 font-bold border-b border-yellow-900/40 pb-2">æŒ‡æŒ¥å®˜åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="space-y-4">
                        <div><label class="text-xs text-gray-500">é€‰æ‹©é˜µè¥</label><select v-model="user.house" class="mt-1"><option v-for="h in ['é»‘é¹«','é’ç‹®å­','é‡‘é¹¿','èµ›ç½—å¸æ•™ä¼š']">{{h}}</option></select></div>
                        <div><label class="text-xs text-gray-500">æŒ‡å¯¼ç­‰çº§</label><select v-model="user.professorLevel" class="mt-1"><option v-for="l in ['E','D','C','B','A','A+']">{{l}}</option></select></div>
                    </div>
                </div>
                <div class="bg-zinc-900 p-6 fe-border rounded col-span-2">
                    <h3 class="text-yellow-500 mb-4 font-bold border-b border-yellow-900/40 pb-2">å®æ—¶èƒ½åŠ›å±æ€§ï¼ˆç”¨äºæŒ–è§’åŒ¹é…ï¼‰</h3>
                    <div class="grid grid-cols-4 gap-4 mb-6">
                        <div v-for="(v,k) in user.stats"><label class="text-[10px] text-gray-400">{{k}}</label><input type="number" v-model.number="user.stats[k]"></div>
                    </div>
                    <h3 class="text-yellow-500 mb-4 font-bold border-b border-yellow-900/40 pb-2">æŠ€èƒ½ç­‰çº§</h3>
                    <div class="grid grid-cols-4 gap-4">
                        <div v-for="(v,k) in user.skills"><label class="text-[10px] text-gray-400">{{k}}</label><select v-model="user.skills[k]" class="text-xs"><option v-for="lv in skillLevels">{{lv}}</option></select></div>
                    </div>
                </div>
                <div class="col-span-3 text-right"><button @click="saveAll" class="bg-green-700 px-10 py-2 rounded font-bold">åŒæ­¥æ‰€æœ‰ä¿®æ”¹</button></div>
            </section>

            <section v-if="currentTab === 'backup'" class="max-w-4xl mx-auto space-y-6">
                <div class="bg-zinc-900 p-6 fe-border rounded">
                    <h3 class="text-yellow-500 font-bold mb-2">æ‰¹é‡å¯¼å…¥ JSON æ”»ç•¥æ•°æ®</h3>
                    <textarea v-model="importData" rows="8" class="text-xs font-mono" placeholder="è¯·åœ¨æ­¤å¤„ç²˜è´´ç¬¦åˆæ ¼å¼çš„ JSON æ•°ç»„..."></textarea>
                    <button @click="handleImport" class="mt-4 bg-yellow-600 text-black w-full py-3 rounded font-bold">ç«‹å³åˆå¹¶å¯¼å…¥</button>
                </div>
                <div class="flex gap-4">
                    <button @click="handleExport" class="bg-zinc-800 flex-1 py-3 rounded text-sm">å¤åˆ¶ç°æœ‰åº“åˆ°å‰ªè´´æ¿</button>
                    <button @click="downloadJSON" class="bg-zinc-800 flex-1 py-3 rounded text-sm">ä¸‹è½½å¤‡ä»½æ–‡ä»¶ (.json)</button>
                </div>
            </section>

            <section v-if="!['profile', 'backup'].includes(currentTab)" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div v-for="item in filteredList" :key="item.id" :class="['card-gradient rounded-lg overflow-hidden flex flex-col fe-border', getHouseClass(item.house)]">
                    <div class="relative h-48 bg-zinc-800 overflow-hidden">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <div v-else class="flex items-center justify-center h-full text-zinc-700 text-xs italic">æš‚æ— å›¾ç‰‡</div>
                        <div class="absolute bottom-0 bg-black/70 w-full p-2 flex justify-between">
                            <span class="font-bold text-yellow-500">{{ item.character }}</span>
                            <div class="flex gap-2">
                                <button @click="openModal(item)" class="text-[10px] bg-blue-900 px-2 py-0.5 rounded">ç¼–è¾‘</button>
                                <button @click="deleteEntry(item.id)" class="text-[10px] bg-red-900 px-2 py-0.5 rounded">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 text-xs space-y-3 flex-1">
                        <div v-if="currentTab === 'tea'">
                            <p class="mb-1"><span class="text-gray-500">èŒ¶å¶ï¼š</span>{{item.data.tea}}</p>
                            <p class="mb-1"><span class="text-gray-500">è¯é¢˜ï¼š</span>{{item.data.topics}}</p>
                            <div class="mt-2 bg-yellow-900/10 p-2 border-l border-yellow-600"><span class="block text-yellow-600 font-bold mb-1">ç¬¬4è½®å»ºè®®:</span>{{item.data.finalAnswer}}</div>
                        </div>

                        <div v-if="currentTab === 'scout'">
                            <p>è¦æ±‚ï¼š{{item.data.reqStat}} {{item.data.reqStatVal}} & {{item.data.reqSkill}} {{item.data.reqSkillLevel}}</p>
                            <div v-if="checkScout(item)" class="text-green-500 font-bold animate-pulse mt-2">âœ… ä¸»è§’å±æ€§å·²è¾¾æ ‡ï¼</div>
                            <div v-else class="text-red-900 mt-2">âŒ å±æ€§æˆ–æŠ€èƒ½ä¸è¶³</div>
                            <p class="text-zinc-500 mt-2 italic">{{item.data.notes}}</p>
                        </div>

                        <div v-if="currentTab === 'items'" class="space-y-3">
                            <div><span class="text-yellow-600 font-bold">ğŸ å–œæ¬¢çš„ç¤¼ç‰©ï¼š</span><p class="text-zinc-300">{{item.data.gifts}}</p></div>
                            <div><span class="text-blue-400 font-bold">ğŸ” ä¸¢å¤±çš„ç‰©å“ï¼š</span><p class="text-zinc-300">{{item.data.lostItems}}</p></div>
                        </div>

                        <div v-if="currentTab === 'dialogue'">
                            <p class="text-yellow-500 font-bold">{{item.data.chapter}} - {{item.data.month}}</p>
                            <p class="mt-2"><span class="text-gray-500">æœ€ä½³é€‰é¡¹ï¼š</span>{{item.data.bestChoice}}</p>
                        </div>

                        <div v-if="currentTab === 'train'">
                            <p><span class="text-gray-500">è½¬èŒè·¯çº¿ï¼š</span>{{item.data.path}}</p>
                            <p><span class="text-gray-500">æ­¦å™¨é“å…·ï¼š</span>{{item.data.items}}</p>
                            <p><span class="text-gray-500">éª‘å£«å›¢ï¼š</span>{{item.data.battalion}}</p>
                        </div>

                        <div v-if="currentTab === 'letter' || currentTab === 'lesson'">
                            <p class="text-zinc-400">é—®ï¼š{{item.data.question}}</p>
                            <p class="text-yellow-500 font-bold mt-2">ç­”ï¼š{{item.data.answer}}</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <div v-if="showModal" class="fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4">
            <div class="bg-zinc-900 fe-border w-full max-w-2xl rounded-lg shadow-2xl flex flex-col max-h-[90vh]">
                <div class="p-4 border-b border-yellow-900 flex justify-between items-center">
                    <h3 class="font-bold text-yellow-500">æ­£åœ¨ç¼–è¾‘ï¼š{{ currentMenuName }}</h3>
                    <button @click="showModal = false" class="text-2xl">âœ•</button>
                </div>
                <div class="p-6 overflow-y-auto custom-scroll grid grid-cols-2 gap-4">
                    <div class="col-span-1"><label class="text-xs text-gray-500">è§’è‰²å</label><input v-model="form.character"></div>
                    <div class="col-span-1"><label class="text-xs text-gray-500">é˜µè¥</label><select v-model="form.house"><option v-for="h in ['é»‘é¹«','é’ç‹®å­','é‡‘é¹¿','èµ›ç½—å¸æ•™ä¼š']">{{h}}</option></select></div>
                    <div class="col-span-2"><label class="text-xs text-gray-500">æ”»ç•¥å›¾ç‰‡ URL/è·¯å¾„</label><input v-model="form.image" placeholder="å¦‚: ./img/char.jpg"></div>

                    <hr class="col-span-2 border-zinc-800 my-2">
                    <template v-if="currentTab === 'tea'">
                        <div class="col-span-1"><label>å–œæ¬¢çš„èŒ¶</label><input v-model="form.data.tea"></div>
                        <div class="col-span-1"><label>è¯é¢˜(1-3è½®)</label><input v-model="form.data.topics"></div>
                        <div class="col-span-2"><label>ç¬¬4è½®é—®ç­”ç­”æ¡ˆ</label><textarea v-model="form.data.finalAnswer"></textarea></div>
                    </template>
                    <template v-if="currentTab === 'scout'">
                        <div class="col-span-1"><label>è¦æ±‚å±æ€§</label><select v-model="form.data.reqStat"><option v-for="(v,k) in user.stats">{{k}}</option></select></div>
                        <div class="col-span-1"><label>æ•°å€¼</label><input type="number" v-model="form.data.reqStatVal"></div>
                        <div class="col-span-1"><label>è¦æ±‚æŠ€èƒ½</label><select v-model="form.data.reqSkill"><option v-for="(v,k) in user.skills">{{k}}</option></select></div>
                        <div class="col-span-1"><label>æŠ€èƒ½ç­‰çº§</label><select v-model="form.data.reqSkillLevel"><option v-for="lv in skillLevels">{{lv}}</option></select></div>
                        <div class="col-span-2"><label>æ³¨æ„äº‹é¡¹</label><textarea v-model="form.data.notes"></textarea></div>
                    </template>
                    <template v-if="currentTab === 'items'">
                        <div class="col-span-2"><label>å–œæ¬¢çš„ç¤¼ç‰© (é€—å·éš”å¼€)</label><textarea v-model="form.data.gifts"></textarea></div>
                        <div class="col-span-2"><label>ä¸¢å¤±çš„ç‰©å“ (é€—å·éš”å¼€)</label><textarea v-model="form.data.lostItems"></textarea></div>
                    </template>
                    <template v-if="currentTab === 'dialogue'">
                        <div class="col-span-1"><label>ç« èŠ‚</label><input v-model="form.data.chapter"></div>
                        <div class="col-span-1"><label>æœˆä»½ä¸èŠ‚</label><input v-model="form.data.month"></div>
                        <div class="col-span-2"><label>æœ€ä½³å¯¹è¯é€‰é¡¹</label><textarea v-model="form.data.bestChoice"></textarea></div>
                    </template>
                    <template v-if="currentTab === 'train'">
                        <div class="col-span-2"><label>è½¬èŒé¡ºåº(å¸¦ç­‰çº§è¦æ±‚)</label><input v-model="form.data.path" placeholder="ä¾‹: å‰‘å£«(Lv5) -> ä½£å…µ(Lv10)"></div>
                        <div class="col-span-1"><label>æ¨èæ­¦å™¨/é“å…·</label><input v-model="form.data.items"></div>
                        <div class="col-span-1"><label>æ¨èéª‘å£«å›¢</label><input v-model="form.data.battalion"></div>
                    </template>
                    <template v-if="currentTab === 'letter' || currentTab === 'lesson'">
                        <div class="col-span-2"><label>é—®é¢˜</label><textarea v-model="form.data.question"></textarea></div>
                        <div class="col-span-2"><label>æ­£ç¡®ç­”æ¡ˆ</label><input v-model="form.data.answer"></div>
                    </template>
                </div>
                <div class="p-4 border-t border-zinc-800 text-right"><button @click="saveEntry" class="bg-yellow-600 text-black px-12 py-2 rounded font-bold uppercase">ä¿å­˜æ”»ç•¥æ•°æ®</button></div>
            </div>
        </div>
    </div>

<script>
const { createApp } = Vue;
createApp({
    data() {
        return {
            currentTab: 'profile', searchQuery: '', showModal: false, isEditing: false, importData: '',
            skillLevels: ['E', 'E+', 'D', 'D+', 'C', 'C+', 'B', 'B+', 'A', 'A+', 'S'],
            skillWeights: { 'E':0, 'E+':1, 'D':2, 'D+':3, 'C':4, 'C+':5, 'B':6, 'B+':7, 'A':8, 'A+':9, 'S':10 },
            user: { house: 'é»‘é¹«', professorLevel: 'E', stats: { 'åŠ›é‡':10,'é­”åŠ›':10,'æŠ€å·§':10,'é€Ÿåº¦':10,'è¿æ°”':10,'å®ˆå¤‡':10,'é­”é˜²':10,'é­…åŠ›':10 }, skills: { 'å‰‘æœ¯':'E','æªæœ¯':'E','æ–§æœ¯':'E','å¼“æœ¯':'E','æ ¼æ–—æœ¯':'E','ç†å­¦':'E','ä¿¡ä»°':'E','æŒ‡æŒ¥':'E','é‡è£…':'E','é©¬æœ¯':'E','é£è¡Œ':'E' } },
            guides: [],
            form: { id: null, type: '', character: '', house: 'é»‘é¹«', image: '', data: {} },
            menus: [
                { id: 'profile', name: 'æˆ‘çš„æ¡£æ¡ˆ', icon: 'ğŸ›¡ï¸' },
                { id: 'tea', name: 'èŒ¶è¯ä¼šæ”»ç•¥', icon: 'ğŸµ' },
                { id: 'dialogue', name: 'å¯¹è¯é€‰é¡¹', icon: 'ğŸ’¬' },
                { id: 'items', name: 'ç¤¼ç‰©/å¤±ç‰©', icon: 'ğŸ' },
                { id: 'letter', name: 'ä¿¡ä»¶æ”»ç•¥', icon: 'âœ‰ï¸' },
                { id: 'train', name: 'åŸ¹å…»æ”»ç•¥', icon: 'âš”ï¸' },
                { id: 'scout', name: 'æŒ–è§’æ”»ç•¥', icon: 'ğŸ¤' },
                { id: 'lesson', name: 'è¯¾å ‚é—®é¢˜', icon: 'ğŸ“–' },
                { id: 'backup', name: 'æ•°æ®ä¸­å¿ƒ', icon: 'ğŸ’¾' }
            ]
        }
    },
    computed: {
        currentMenuName() { return this.menus.find(m => m.id === this.currentTab).name },
        filteredList() {
            let list = this.guides.filter(g => g.type === this.currentTab);
            if(this.searchQuery) {
                const q = this.searchQuery.toLowerCase();
                list = list.filter(g => g.character.includes(q) || g.house.includes(q));
            }
            return list;
        }
    },
    methods: {
        getHouseClass(h) { return { 'house-eagle': h==='é»‘é¹«', 'house-lion': h==='é’ç‹®å­', 'house-deer': h==='é‡‘é¹¿' }; },
        openModal(editItem = null) {
            this.showModal = true;
            if (editItem) {
                this.isEditing = true;
                this.form = JSON.parse(JSON.stringify(editItem));
            } else {
                this.isEditing = false;
                this.form = { id: Date.now(), type: this.currentTab, character: '', house: 'é»‘é¹«', image: '', data: this.initData(this.currentTab) };
            }
        },
        initData(t) {
            const s = { 
                tea: { tea:'', topics:'', finalAnswer:'' }, 
                scout: { reqStat:'é€Ÿåº¦', reqStatVal:15, reqSkill:'å‰‘æœ¯', reqSkillLevel:'B', notes:'' },
                items: { gifts:'', lostItems:'' },
                dialogue: { chapter:'', month:'', bestChoice:'' },
                train: { path:'', items:'', battalion:'' },
                letter: { question:'', answer:'' },
                lesson: { question:'', answer:'' }
            };
            return s[t] || {};
        },
        saveEntry() {
            if(!this.form.character) return alert("è¯·å¡«å†™è§’è‰²å");
            if(this.isEditing) {
                const i = this.guides.findIndex(g => g.id === this.form.id);
                this.guides[i] = JSON.parse(JSON.stringify(this.form));
            } else {
                this.guides.push(JSON.parse(JSON.stringify(this.form)));
            }
            this.saveAll();
            this.showModal = false;
        },
        deleteEntry(id) { if(confirm('åˆ é™¤åæ— æ³•æ¢å¤ï¼Œç¡®å®šå—ï¼Ÿ')) { this.guides = this.guides.filter(g => g.id !== id); this.saveAll(); } },
        checkScout(item) {
            const d = item.data;
            const sMet = this.user.stats[d.reqStat] >= d.reqStatVal;
            const kMet = this.skillWeights[this.user.skills[d.reqSkill]] >= this.skillWeights[d.reqSkillLevel];
            return sMet && kMet;
        },
        handleImport() {
            try {
                const d = JSON.parse(this.importData);
                this.guides = Array.isArray(d) ? [...this.guides, ...d] : this.guides;
                this.saveAll();
                alert("å¯¼å…¥æˆåŠŸï¼Œæ•°æ®å·²åˆå¹¶å¹¶ä¿å­˜ï¼");
                this.importData = "";
            } catch(e) { alert("å¯¼å…¥å¤±è´¥ï¼šJSON æ ¼å¼ä¸æ­£ç¡®"); }
        },
        handleExport() {
            navigator.clipboard.writeText(JSON.stringify(this.guides));
            alert("å…¨éƒ¨æ”»ç•¥æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
        },
        downloadJSON() {
            const blob = new Blob([JSON.stringify(this.guides)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = "FE3H_Backup.json"; a.click();
        },
        saveAll() {
            localStorage.setItem('fe3h_v3_guides', JSON.stringify(this.guides));
            localStorage.setItem('fe3h_v3_user', JSON.stringify(this.user));
        },
        loadAll() {
            const g = localStorage.getItem('fe3h_v3_guides');
            const u = localStorage.getItem('fe3h_v3_user');
            if(g) this.guides = JSON.parse(g);
            if(u) this.user = JSON.parse(u);
        }
    },
    mounted() { this.loadAll(); }
}).mount('#app');
</script>
</body>
</html>
